(function($,F){F.Editing=F.Component.extend({construct:function(table){this._super(table,table.o.editing.enabled);this.pageToNew=table.o.editing.pageToNew;this.alwaysShow=table.o.editing.alwaysShow;this.column=$.extend(true,{},table.o.editing.column,{visible:this.alwaysShow});this.position=table.o.editing.position;this.showText=table.o.editing.showText;this.hideText=table.o.editing.hideText;this.addText=table.o.editing.addText;this.editText=table.o.editing.editText;this.deleteText=table.o.editing.deleteText;this.viewText=table.o.editing.viewText;this.allowAdd=table.o.editing.allowAdd;this.allowEdit=table.o.editing.allowEdit;this.allowDelete=table.o.editing.allowDelete;this.allowView=table.o.editing.allowView;this._$buttons=null;this.callbacks={addRow:F.checkFnValue(this,table.o.editing.addRow),editRow:F.checkFnValue(this,table.o.editing.editRow),deleteRow:F.checkFnValue(this,table.o.editing.deleteRow),viewRow:F.checkFnValue(this,table.o.editing.viewRow)};},preinit:function(data){var self=this;this.ft.raise('preinit.ft.editing',[data]).then(function(){if(self.ft.$el.hasClass('footable-editing'))
self.enabled=true;self.enabled=F.is.boolean(data.editing)?data.editing:self.enabled;if(!self.enabled)return;self.pageToNew=F.is.boolean(data.editingPageToNew)?data.editingPageToNew:self.pageToNew;self.alwaysShow=F.is.boolean(data.editingAlwaysShow)?data.editingAlwaysShow:self.alwaysShow;self.position=F.is.string(data.editingPosition)?data.editingPosition:self.position;self.showText=F.is.string(data.editingShowText)?data.editingShowText:self.showText;self.hideText=F.is.string(data.editingHideText)?data.editingHideText:self.hideText;self.addText=F.is.string(data.editingAddText)?data.editingAddText:self.addText;self.editText=F.is.string(data.editingEditText)?data.editingEditText:self.editText;self.deleteText=F.is.string(data.editingDeleteText)?data.editingDeleteText:self.deleteText;self.viewText=F.is.string(data.editingViewText)?data.editingViewText:self.viewText;self.allowAdd=F.is.boolean(data.editingAllowAdd)?data.editingAllowAdd:self.allowAdd;self.allowEdit=F.is.boolean(data.editingAllowEdit)?data.editingAllowEdit:self.allowEdit;self.allowDelete=F.is.boolean(data.editingAllowDelete)?data.editingAllowDelete:self.allowDelete;self.allowView=F.is.boolean(data.editingAllowView)?data.editingAllowView:self.allowView;self.column=new F.EditingColumn(self.ft,self,$.extend(true,{},self.column,data.editingColumn,{visible:self.alwaysShow}));if(self.ft.$el.hasClass('footable-editing-left'))
self.position='left';if(self.ft.$el.hasClass('footable-editing-right'))
self.position='right';if(self.position==='right'){self.column.index=self.ft.columns.array.length;}else{self.column.index=0;for(var i=0,len=self.ft.columns.array.length;i<len;i++){self.ft.columns.array[i].index+=1;}}
self.ft.columns.array.push(self.column);self.ft.columns.array.sort(function(a,b){return a.index-b.index;});self.callbacks.addRow=F.checkFnValue(self,data.editingAddRow,self.callbacks.addRow);self.callbacks.editRow=F.checkFnValue(self,data.editingEditRow,self.callbacks.editRow);self.callbacks.deleteRow=F.checkFnValue(self,data.editingDeleteRow,self.callbacks.deleteRow);self.callbacks.viewRow=F.checkFnValue(self,data.editingViewRow,self.callbacks.viewRow);},function(){self.enabled=false;});},init:function(){var self=this;this.ft.raise('init.ft.editing').then(function(){self.$create();},function(){self.enabled=false;});},destroy:function(){var self=this;this.ft.raise('destroy.ft.editing').then(function(){self.ft.$el.removeClass('footable-editing footable-editing-always-show footable-editing-no-add footable-editing-no-edit footable-editing-no-delete footable-editing-no-view').off('click.ft.editing').find('tfoot > tr.footable-editing').remove();});},$create:function(){var self=this,position=self.position==='right'?'footable-editing-right':'footable-editing-left';self.ft.$el.addClass('footable-editing').addClass(position).on('click.ft.editing','.footable-show',{self:self},self._onShowClick).on('click.ft.editing','.footable-hide',{self:self},self._onHideClick).on('click.ft.editing','.footable-edit',{self:self},self._onEditClick).on('click.ft.editing','.footable-delete',{self:self},self._onDeleteClick).on('click.ft.editing','.footable-view',{self:self},self._onViewClick).on('click.ft.editing','.footable-add',{self:self},self._onAddClick);self.$cell=$('<td/>').attr('colspan',self.ft.columns.visibleColspan).append(self.$buttonShow());if(self.allowAdd){self.$cell.append(self.$buttonAdd());}
self.$cell.append(self.$buttonHide());if(self.alwaysShow){self.ft.$el.addClass('footable-editing-always-show');}
if(!self.allowAdd)self.ft.$el.addClass('footable-editing-no-add');if(!self.allowEdit)self.ft.$el.addClass('footable-editing-no-edit');if(!self.allowDelete)self.ft.$el.addClass('footable-editing-no-delete');if(!self.allowView)self.ft.$el.addClass('footable-editing-no-view');var $tfoot=self.ft.$el.children('tfoot');if($tfoot.length==0){$tfoot=$('<tfoot/>');self.ft.$el.append($tfoot);}
self.$row=$('<tr/>',{'class':'footable-editing'}).append(self.$cell).appendTo($tfoot);},$buttonShow:function(){return '<button type="button" class="btn btn-primary footable-show">'+this.showText+'</button>';},$buttonHide:function(){return '<button type="button" class="btn btn-default footable-hide">'+this.hideText+'</button>';},$buttonAdd:function(){return '<button type="button" class="btn btn-primary footable-add">'+this.addText+'</button> ';},$buttonEdit:function(){return '<button type="button" class="btn btn-default footable-edit">'+this.editText+'</button> ';},$buttonDelete:function(){return '<button type="button" class="btn btn-default footable-delete">'+this.deleteText+'</button>';},$buttonView:function(){return '<button type="button" class="btn btn-default footable-view">'+this.viewText+'</button> ';},$rowButtons:function(){if(F.is.jq(this._$buttons))return this._$buttons.clone();this._$buttons=$('<div class="btn-group btn-group-xs" role="group"></div>');if(this.allowView)this._$buttons.append(this.$buttonView());if(this.allowEdit)this._$buttons.append(this.$buttonEdit());if(this.allowDelete)this._$buttons.append(this.$buttonDelete());return this._$buttons;},draw:function(){this.$cell.attr('colspan',this.ft.columns.visibleColspan);},_onEditClick:function(e){e.preventDefault();var self=e.data.self,row=$(this).closest('tr').data('__FooTableRow__');if(row instanceof F.Row){self.ft.raise('edit.ft.editing',[row]).then(function(){self.callbacks.editRow.call(self.ft,row);});}},_onDeleteClick:function(e){e.preventDefault();var self=e.data.self,row=$(this).closest('tr').data('__FooTableRow__');if(row instanceof F.Row){self.ft.raise('delete.ft.editing',[row]).then(function(){self.callbacks.deleteRow.call(self.ft,row);});}},_onViewClick:function(e){e.preventDefault();var self=e.data.self,row=$(this).closest('tr').data('__FooTableRow__');if(row instanceof F.Row){self.ft.raise('view.ft.editing',[row]).then(function(){self.callbacks.viewRow.call(self.ft,row);});}},_onAddClick:function(e){e.preventDefault();var self=e.data.self;self.ft.raise('add.ft.editing').then(function(){self.callbacks.addRow.call(self.ft);});},_onShowClick:function(e){e.preventDefault();var self=e.data.self;self.ft.raise('show.ft.editing').then(function(){self.ft.$el.addClass('footable-editing-show');self.column.visible=true;self.ft.draw();});},_onHideClick:function(e){e.preventDefault();var self=e.data.self;self.ft.raise('hide.ft.editing').then(function(){self.ft.$el.removeClass('footable-editing-show');self.column.visible=false;self.ft.draw();});}});F.components.register('editing',F.Editing,850);})(jQuery,FooTable);(function($,F){F.EditingColumn=F.Column.extend({construct:function(instance,editing,definition){this._super(instance,definition,'editing');this.editing=editing;this.internal=true;},$create:function(){(this.$el=!this.virtual&&F.is.jq(this.$el)?this.$el:$('<th/>',{'class':'footable-editing'})).html(this.title);},parser:function(valueOrElement){if(F.is.string(valueOrElement))valueOrElement=$($.trim(valueOrElement));if(F.is.element(valueOrElement))valueOrElement=$(valueOrElement);if(F.is.jq(valueOrElement)){var tagName=valueOrElement.prop('tagName').toLowerCase();if(tagName=='td'||tagName=='th')return valueOrElement.data('value')||valueOrElement.contents();return valueOrElement;}
return null;},createCell:function(row){var $buttons=this.editing.$rowButtons(),$cell=$('<td/>').append($buttons);if(F.is.jq(row.$el)){if(this.index===0){$cell.prependTo(row.$el);}else{$cell.insertAfter(row.$el.children().eq(this.index-1));}}
return new F.Cell(this.ft,row,this,$cell||$cell.html());}});F.columns.register('editing',F.EditingColumn);})(jQuery,FooTable);(function($,F){F.Defaults.prototype.editing={enabled:false,pageToNew:true,position:'right',alwaysShow:false,addRow:function(){},editRow:function(row){},deleteRow:function(row){},viewRow:function(row){},showText:'<span class="fooicon fooicon-pencil" aria-hidden="true"></span> Edit rows',hideText:'Cancel',addText:'New row',editText:'<span class="fooicon fooicon-pencil" aria-hidden="true"></span>',deleteText:'<span class="fooicon fooicon-trash" aria-hidden="true"></span>',viewText:'<span class="fooicon fooicon-stats" aria-hidden="true"></span>',allowAdd:true,allowEdit:true,allowDelete:true,allowView:false,column:{classes:'footable-editing',name:'editing',title:'',filterable:false,sortable:false}};})(jQuery,FooTable);(function($,F){if(F.is.defined(F.Paging)){F.Paging.prototype.unpaged=[];F.Paging.extend('predraw',function(){this.unpaged=this.ft.rows.array.slice(0);this._super();});}})(jQuery,FooTable);(function($,F){F.Row.prototype.add=function(redraw){redraw=F.is.boolean(redraw)?redraw:true;var self=this;return $.Deferred(function(d){var index=self.ft.rows.all.push(self)-1;if(redraw){return self.ft.draw().then(function(){d.resolve(index);});}else{d.resolve(index);}});};F.Row.prototype.delete=function(redraw){redraw=F.is.boolean(redraw)?redraw:true;var self=this;return $.Deferred(function(d){var index=self.ft.rows.all.indexOf(self);if(F.is.number(index)&&index>=0&&index<self.ft.rows.all.length){self.ft.rows.all.splice(index,1);if(redraw){return self.ft.draw().then(function(){d.resolve(self);});}}
d.resolve(self);});};if(F.is.defined(F.Paging)){F.Row.extend('add',function(redraw){redraw=F.is.boolean(redraw)?redraw:true;var self=this,added=this._super(redraw),editing=self.ft.use(F.Editing),paging;if(editing&&editing.pageToNew&&(paging=self.ft.use(F.Paging))&&redraw){return added.then(function(){var index=paging.unpaged.indexOf(self);var page=Math.ceil((index+1)/paging.size);if(paging.current!==page){return paging.goto(page);}});}
return added;});}
if(F.is.defined(F.Sorting)){F.Row.extend('val',function(data,redraw){redraw=F.is.boolean(redraw)?redraw:true;var result=this._super(data);if(!F.is.hash(data)){return result;}
var self=this;if(redraw){self.ft.draw().then(function(){var editing=self.ft.use(F.Editing),paging;if(F.is.defined(F.Paging)&&editing&&editing.pageToNew&&(paging=self.ft.use(F.Paging))){var index=paging.unpaged.indexOf(self);var page=Math.ceil((index+1)/paging.size);if(paging.current!==page){return paging.goto(page);}}});}
return result;});}})(jQuery,FooTable);(function(F){F.Rows.prototype.add=function(dataOrRow,redraw){var row=dataOrRow;if(F.is.hash(dataOrRow)){row=new FooTable.Row(this.ft,this.ft.columns.array,dataOrRow);}
if(row instanceof FooTable.Row){row.add(redraw);}};F.Rows.prototype.update=function(indexOrRow,data,redraw){var len=this.ft.rows.all.length,row=indexOrRow;if(F.is.number(indexOrRow)&&indexOrRow>=0&&indexOrRow<len){row=this.ft.rows.all[indexOrRow];}
if(row instanceof FooTable.Row&&F.is.hash(data)){row.val(data,redraw);}};F.Rows.prototype.delete=function(indexOrRow,redraw){var len=this.ft.rows.all.length,row=indexOrRow;if(F.is.number(indexOrRow)&&indexOrRow>=0&&indexOrRow<len){row=this.ft.rows.all[indexOrRow];}
if(row instanceof FooTable.Row){row.delete(redraw);}};})(FooTable);